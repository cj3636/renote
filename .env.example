# Renote Environment Configuration Example
# Copy to .env and adjust values. Empty values fall back to defaults in config.php.
# --- Value Safety (systemd EnvironmentFile) ---
# If a value contains '#', spaces, or leading/trailing whitespace, wrap it in double quotes:
#   VAR="my#value with spaces"
# Or escape only the hash: VAR=my\#value
# Do NOT put inline comments after quoted values (they become part of the value).
# Example unsafe without quotes: DB_PASS=p@ss#frag  (# would start a comment)
# Example safe:              DB_PASS="p@ss#frag"
# Example escaped (unquoted): DB_PASS=p@ss\#frag

# Enables debug/history UI; keep false in production
APP_DEBUG=false
# true: Redis stream + worker flush; false: synchronous DB writes (slower)
APP_WRITE_BEHIND=true
# batch | continuous (match your service/timer configuration)
APP_WRITE_BEHIND_MODE=batch
# Approximate max stream entries; lowering too far may drop unflushed events if worker is down
APP_STREAM_MAXLEN=20000
# Maximum characters per card (returns text_too_long when exceeded)
APP_CARD_MAX_LEN=262144
# true enforces UUIDv4 IDs; false allows hex (16-64 chars)
APP_REQUIRE_UUID=false

# unix (preferred locally) | tcp
REDIS_CONNECTION=unix
# Path to Redis UNIX domain socket (used when REDIS_CONNECTION=unix)
REDIS_SOCKET=/var/run/redis/redis.sock
# Redis host (used when REDIS_CONNECTION=tcp)
REDIS_HOST=127.0.0.1
# Redis TCP port
REDIS_PORT=6379
# Redis username if ACLs enabled (leave blank if unused)
REDIS_USERNAME=
# Redis password (optional)
REDIS_PASSWORD=""

# Prefer sockets for latency; set false to use TCP with DB_HOST/DB_PORT
DB_USE_SOCKET=true
# MariaDB/MySQL socket path (when DB_USE_SOCKET=true)
DB_SOCKET=/run/mysqld/mysqld.sock
# MariaDB host (used when DB_USE_SOCKET=false)
DB_HOST=127.0.0.1
# MariaDB TCP port
DB_PORT=3306
# Database name
DB_NAME=pnotes
# Database user
DB_USER=pnoteuser
# Database password (required)
DB_PASS=""

# Disable only on trusted networks; otherwise provide CA/cert/key paths
DB_SSL_ENABLE=true
# Set true to verify server certificate against DB_SSL_CA
DB_SSL_VERIFY=false
# CA certificate path
DB_SSL_CA=ssl/ca.crt
# Client certificate path
DB_SSL_CRT=ssl/client.crt
# Client private key path
DB_SSL_KEY=ssl/client.key

# Blocking wait when worker runs continuously (milliseconds)
WORKER_BLOCK_MS=5000
# Max events processed before committing; raise carefully to avoid long locks
WORKER_MAX_BATCH=1000
# Trim stream after this many processed events (approximate)
WORKER_TRIM_EVERY=500
# Health: backlog below this is ok
WORKER_MIN_OK_LAG=20
# Health: backlog below this is degraded; otherwise backlog
WORKER_MIN_DEGRADED_LAG=200
# Seconds between scheduled flushes when using systemd timer
BATCH_FLUSH_EXPECTED_INTERVAL=180

# If true, worker deletes nearly empty cards (< EMPTY_MINLEN) from DB
PRUNE_EMPTY=true
# Minimum non-whitespace length to keep a card if PRUNE_EMPTY=true
EMPTY_MINLEN=1
# Seconds per rate limit window
RATE_LIMIT_WINDOW=60
# Mutating requests per IP per window; set 0 to disable rate limiting
RATE_LIMIT_MAX=300

# Keep the newest N snapshots per card (older trimmed)
APP_VERSION_MAX_PER_CARD=25
# Minimum seconds between auto snapshots during flush
APP_VERSION_MIN_INTERVAL_SEC=60
# Minimum character delta since last snapshot to auto-capture
APP_VERSION_MIN_SIZE_DELTA=20
# Age-based pruning; 0 disables (keep all until count limit trims)
APP_VERSION_RETENTION_DAYS=0
